"use strict";function BaseModelObserver(){var e=function(e){e=e||null;var t,r,n,i=function(e){return"undefined"==typeof e},o=function(e){return"function"!=typeof e},a=function(e,t){if(o(e))throw new Error('"signature" parameter should be of type "function"');if(o(t))throw new Error('"implementation" parameter should be of type "function"');return e.length!==t.length};switch(!0){case null===e:throw new Error("No arguments supplied to an instance of Interface constructor.");case i(e.type):throw new Error("Interface.type not defined.");case i(e.implementation):throw new Error("The interface ".concat(e.type).concat(" has not been implemented."))}t=e.type,r=e.implementation,n={};for(var s in e){var u=e[s];o(u)||(n[s]=u)}for(var u in n){if(i(r[u]))throw new Error(t.concat(".").concat(u).concat(" has not been implemented."));for(var s in r){var c=r[s];switch(!0){case i(n[s]):throw new Error(s.concat(" is not a defined member of ").concat(t).concat("."));case o(c):throw new Error(t.concat(".").concat(s).concat(" has not been implemented as a function."));case a(n[s],c):throw new Error("An implementation of ".concat(t).concat(".").concat(s).concat(" does not have the correct number of arguments."));default:n[s]=c}}}return n},t={interfaces:{},create:function(e,t){this.interfaces[e]=t},implement:function(t,r){return this.interfaces[t].implementation=r,this.interfaces[t].type=t,new e(this.interfaces[t])}},r=r||{};return r.triggerApi=function(){var e={},r={};return this.create=function(e,r){var n={};n[e]=r,t.create(e,n)},t.create("init",{init:function(e,t,r,n,i){return e}}),t.create("get",{get:function(e,t){return e}}),t.create("set",{set:function(e,t,r){return e}}),t.create("remove",{remove:function(e,t,r,n,i){return e}}),t.create("add",{add:function(e,t,r,n,i){return e}}),t.create("order",{order:function(e,t,r){return e}}),this.defines=function(e){for(var t in e){var r={};r[t]=e[t],this.define(t,r)}},this.define=function(n,i){var o=t.implement(n,i);for(var a in i)i.hasOwnProperty(a)&&(e.hasOwnProperty(a)||(e[a]=[]),Object.defineProperty(r,a,{get:function(){return e[a]},set:function(t){e[a].push(t)},enumerable:!0,configurable:!0}),r[a]=o[a])},this.runTrigger=function(t){for(var r in e[t])e[t].hasOwnProperty(r)&&(arguments[1][0]=e[t][r].apply(this,arguments[1]),"function"==typeof arguments[1][0]&&(arguments[1][0]=arguments[1][0].bind(this)()));return arguments[1][0]},this},r.triggers=new r.triggerApi,r.createModel=function(e,t,n,i){var i="undefined"!=typeof i?i:"root",o={};o[i]=e;var a=r.rec(o,t,n);return a[i]},r.rec=function(e,t,n){var t=t||[];for(var i in e)t.push(i),r.define(e[i],e,i,t.slice(),n),"object"==typeof e[i]&&r.rec(e[i],t,e),t.pop();return e},r.define=function(e,t,n,i,o){e=r.triggers.runTrigger("init",[e,t,n,i,o]),Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return r.triggers.runTrigger.bind(this)("get",[e,i])},set:function(t){e=r.triggers.runTrigger.bind(this)("set",[t,e,i])}})},r}function ModelFormTriggers(e,t){function r(e){return e&&"Array"==e.constructor.name}function n(e,t){for(var r in e)if(e[r]==t)return!0;return!1}function i(e){return void 0===e||null===e||"boolean"==typeof e||""===String(e).trim()?!1:String(parseInt(e))===String(e)}function o(e){if(void 0===e||null===e||"boolean"==typeof e||""===String(e).trim())return!1;var t=String(e),r=t.split(".");if(t.indexOf(".")>-1&&2==r.length){var n=String(parseFloat(t).toFixed(r[1].length));return""!=r[0]&&n==t||""==r[0]&&n.replace("0.",".")==t}return!1}function a(e,t){return"integer"==t.attr("data-type")&&i(e)?parseInt(e):"number"==t.attr("data-type")&&o(e)?parseFloat(e):e}var t=t||"data-bind",s=s||{};return s.selector=function(e){return"["+t+'="'+e.join(".")+'"]'},s.initter=function(e,t,i,o){o.length&&void 0!==o.prop("value")&&o.change(function(r){o.hasClass("select2")?s.callback():e[t]=e[t].value}),r(i)&&o.length?"select-multiple"==o[0].type?o.val(i):$.each(o,function(e,t){this.checked=n(i,t.value)}):o.length&&("checkbox"==o[0].type?o[0].checked=Boolean(i):"radio"==o[0].type?$.each(o,function(e,t){this.checked=i==t.value}):"select"==o[0].type||"select-one"==o[0].type?o[0].selected=i==o.val():void 0!==o.prop("value")?o.val(i):o.text(i))},s.setter=function(e,t){t.length>1?$.each(t,function(r,i){"radio"==i.type?t[r].checked=i.value==e:"checkbox"==i.type?n(e,i.value)?$(this).prop("checked","checked"):$(this).removeAttr("checked"):void 0!==$(this).prop("value")?$(this).val(e):$(this).text(e)}):t.length&&("checkbox"==t[0].type?t[0].checked=Boolean(e):t.hasClass("select2")?t.val(e).trigger("change"):void 0!==t.prop("value")?t.val(e):t.text(e))},s.getter=function(e,t){if(t.length&&t[0].multiple){if("select-multiple"==t[0].type)return t.val()?t.val().map(function(e){return a(e,t)}):[];if("checkbox"==t[0].type)return t.filter(function(){return this.checked}).map(function(){return a($(this).attr("value"),t)}).get()}else{if(t.length&&"radio"==t[0].type)return a($(t).filter(function(){return this.checked}).val(),t);if(t.length)return"checkbox"==t[0].type?t[0].checked:void 0!==t.prop("value")?a(t.val(),t):a(t.text(),t)}},s.callback=function(){},s.triggers={init:function(e,t,r,n,i){return s.initter(t,r,e.value,$(s.selector(n))),e},get:function(e,t){return e.value=s.getter(e.value,$(s.selector(t))),e},set:function(e,t,r){return s.setter(e.value,$(s.selector(r))),s.callback(),e},add:function(e,t,r,n,i){return e},remove:function(e,t,r,n,i){return e}},{formTriggers:s.triggers}}function ModelValueTriggers(e){function t(e){return e&&"Array"==e.constructor.name}function r(e){return"undefined"==typeof e||1==e?(new Date).toISOString():Date.now()}function n(e,t){for(var r in t)"object"!=typeof e[r]?e[r]=t[r]:"object"==typeof t[r]&&(e[r]=n(e[r],t[r]));return e}function i(e,t,r,i,o){var a=e[t],r=n({enumerable:!1,configurable:!0},r||{});r.get=i||function(){return a},r.set=o||function(e){a=e},Object.defineProperty(e,t,r)}function o(e){var t=e.value,n={enumerable:!1,configurable:!0};n.get=function(){return this.canget?t:void 0},n.set=function(e){this.canset&&(t=e,this.updated=r())},Object.defineProperty(e,"value",n)}function a(t){var n=(t.value,{enumerable:!1,configurable:!0});n.get=function(){var e={};if(this.canget)for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t].value);return e},n.set=function(t){if(this.canset){var n=this.path.slice();for(var i in t){if(n.push(i),this.hasOwnProperty(i))this[i].value=t[i],this[i].updated=r();else{if("object"==typeof t[i]){e.createModel(t[i],n.slice(0,-1),this,i);this[i]=t[i]}else e.define(t[i],this,i,n.slice(0),this);this[i].parent=this,this.updated=r()}n.pop()}}},Object.defineProperty(t,"value",n)}function s(e,t,r){var n=e[t]=r||!0,o=function(){return n},a=function(e){n=e;for(var r in this)this[r].hasOwnProperty(t)&&(this[r][t]=n)};i(e,t,{configurable:!0},o,a)}function u(e,t,r){Object.defineProperty(e,t,{value:e[t]||r,enumerable:!1,configurable:!1,writable:!1})}function c(e,t,r){var n=e[t]=r,o=function(){return n},a=function(e){n=e,this.parent&&(this.parent[t]=e)};i(e,t,{enumerable:!1,configurable:!0},o,a)}function h(e){var t=function(){return this.parent?[this.key].concat(this.parent.path.reverse()).reverse():[this.key]};i(e,"path",{configurable:!0},t)}function f(t,n){t[n].push=function(){if(arguments){e.triggers.runTrigger.bind(this)("add",[arguments,t[n],this.length,this.path,this.parent]);for(var i in arguments)"object"==typeof arguments[i]?(e.createModel(arguments[i],this.path.slice(0),this.parent,this.length),this[this.length]=arguments[i]):(e.define(arguments[i],this,this.length,this.path.slice(),this.parent),this[this.length-1].parent=this);this.updated=r()}},i(t[n],"push")}function l(t,n){t[n].unshift=function(){for(var i in arguments){var o=this.length;if(o>0){do delete this[o],this[o]=this[o-1],this[o].key=o,this[o].updated=r(),this[o].parent=this,o-=1;while(o>0);delete this[0]}"object"==typeof arguments[i]?(e.createModel(arguments[i],this.path.slice(0),this.parent,0),this[0]=arguments[i],this[0].parent=this):(e.define(arguments[i],this,0,this.path.slice(),this.parent),this[0].parent=this),this.updated=r()}return e.triggers.runTrigger.bind(this)("add",[arguments,t[n],0,this.path,this.parent])},i(t[n],"unshift")}function p(e,t){e[t].pop=function(){return this.parent[t].remove(-1)},i(e[t],"pop")}function d(e,t){e[t].shift=function(){return this.parent[t].remove(0)},i(e[t],"shift")}function g(t,r){t[r].reorder=function(r){var n=[];for(var i in arguments)i>0&&n.push(arguments[i]);var o=[];for(var i in this)o.push(parseInt(this[i].key));var a=r.apply(this,n),s=[];for(var i in this)s.push(parseInt(this[i].key));return this.map(function(e,t){e.key=parseInt(t)}),e.triggers.runTrigger.bind(this)("order",[["reorder",0,0,0,o,s],t,this.path]),a},i(t[r],"reorder")}function v(t,r){t[r].move=function(r,n,i){var o=this,a=o.length-1;r>a?r=a:0>r&&(r=0),i>a?i=a:0>i&&(i=0);var s=[r>i?i:i+1-n,0],u=[];for(var c in this)u.push(parseInt(o[c].key));s.push.apply(s,o.splice(r,n)),o.splice.apply(o,s);var h=[];for(var c in this)h.push(parseInt(o[c].key));o.map(function(e,t){e.key=t}),e.triggers.runTrigger.bind(this)("order",[["move",r,n,i,u,h],t,this.path])},i(t[r],"move")}function m(t,r){t[r].swap=function(r,n){var i=[];for(var o in this)i.push(parseInt(list[o].key));this[r].key=n,this[n].key=r;var a=[];for(var o in this)a.push(parseInt(list[o].key));var s=this[r],u=this[n];this[r]=u,this[n]=s,e.triggers.runTrigger.bind(this)("order",[["swap",r,1,n,i,a],t,this.path])},i(t[r],"swap")}function y(t,n){t[n].remove=function(t,n){var i=this.length,o=[];if(void 0==t){for(var a in this)o.push(this[a]),delete this[a];this.arrayMutation&&this.splice(0,i)}else if("string"==typeof t)o.push(this[t]),delete this[t];else if("number"==typeof t&&(0>t&&(t+=i),t>-1&&i>t)){(void 0==n||1>n)&&(n=1),n>i-t&&(n=i-t);var s=t;do o.push(this[s]),delete this[s],s+=1;while(t+n>s);this.splice(t,n)}return this.updated=r(),e.triggers.runTrigger.bind(this)("remove",[o,this,t])},i(t[n],"remove")}Date.now||(Date.now=function(){return(new Date).getTime()});var b={init:function(e,n,b,w,k){null!==e&&"object"==typeof e?(n[b].value=e,a(n[b]),n[b].branch=!0,i(n[b],"branch"),y(n,b),t(e)&&(n[b].arrayMutation=!0,i(n[b],"arrayMutation"),i(n[b],"order"),f(n,b),p(n,b),d(n,b),l(n,b),g(n,b),v(n,b),m(n,b))):(n[b]={value:e},o(n[b]),n[b].node=!0,i(n[b],"node")),n[b].key=b,i(n[b],"key");var x,T,M={enumerable:!1,configurable:!0};return x=w.length>1?w[w.length-2]:null,x&&(T=k[x]),n[b].parent=T,i(n[b],"parent",M),n[b].path=w,h(n[b],"path"),n[b].old_value=e,i(n[b],"old_value",M),s(n[b],"canget",n[b].canget),s(n[b],"canset",n[b].canset),u(n[b],"created",n[b].created||r()),c(n[b],"updated",n[b].updated),(null===e||"object"!=typeof e)&&(e=n[b]),e},set:function(e,t,r){return this.arrayMutation?e:(t.old_value=t.value,t.value=e,t)}};return{valueTriggers:b}}"undefined"!=typeof module&&("undefined"==typeof module.exports&&(module.exports={}),exports.BaseModelObserver=BaseModelObserver),"undefined"!=typeof module&&("undefined"==typeof module.exports&&(module.exports={}),exports.ModelFormTriggers=ModelFormTriggers),"undefined"!=typeof module&&("undefined"==typeof module.exports&&(module.exports={}),module.exports.ModelValueTriggers=ModelValueTriggers);